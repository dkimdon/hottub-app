#!/usr/bin/env ruby

require 'bwa/client'
require 'bwa/discovery'

if ARGV.empty?
  spas = BWA::Discovery.discover
  if spas.empty?
    $stderr.puts "Could not find spa!"
    exit 1
  end
  spa_ip = spas.first.first
else
  spa_ip = ARGV[0]
end

spa = BWA::Client.new(spa_ip)

spa.last_status
message = spa.poll
puts "#{message.inspect}"

spa.set_temperature_range("low")
spa.set_heating_mode("rest")

spa.set_temperature(55)

spa.last_status
message = spa.poll
puts "#{message.inspect}"
