#!/usr/bin/env ruby

require 'bwa/client'
require 'bwa/discovery'

if ARGV.empty?
  spas = BWA::Discovery.discover
  if spas.empty?
    $stderr.puts "Could not find spa!"
    exit 1
  end
  spa_ip = spas.first.first
else
  spa_ip = ARGV[0]
end

spa = BWA::Client.new(spa_ip)

spa.last_status
message = spa.poll
puts "#{message.inspect}"

#if message.temperature_range.to_s == "high"
#    puts "temperature range is"
#    puts message.temperature_range.to_s
#    puts "toggling temperature range"
#    spa.toggle_temperature_range()
#end

spa.set_temperature_range("high")

#if message.heating_mode.to_s == "ready"
#    puts "heating mode is"
#    puts message.heating_mode.to_s
#    puts "toggling heating mode"
#    spa.toggle_heating_mode()
#end
spa.set_heating_mode("ready")

spa.set_temperature(106)

spa.last_status
message = spa.poll
puts "#{message.inspect}"
