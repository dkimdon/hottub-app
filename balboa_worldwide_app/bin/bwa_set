#!/usr/bin/env ruby

require 'bwa/client'
require 'bwa/discovery'

spas = BWA::Discovery.discover
if spas.empty?
  $stderr.puts "Could not find spa!"
  exit 1
end
spa_ip = spas.first.first

temperature_range = ARGV[0]
heating_mode = ARGV[1]
set_temperature = ARGV[2].to_i

spa = BWA::Client.new(spa_ip)

spa.last_status
message = spa.poll
puts "#{message.inspect}"

spa.set_temperature_range(temperature_range)
spa.set_heating_mode(heating_mode)
spa.set_temperature(set_temperature)

spa.last_status
message = spa.poll
puts "#{message.inspect}"
