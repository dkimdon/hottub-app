#!/usr/bin/env ruby

require 'bwa/client'
require 'bwa/discovery'

if ARGV.empty?
  spas = BWA::Discovery.discover
  if spas.empty?
    $stderr.puts "Could not find spa!"
    exit 1
  end
  spa_ip = spas.first.first
else
  spa_ip = ARGV[0]
end

spa = BWA::Client.new(spa_ip)

spa.last_status
message = spa.poll
puts "CURRENT_TEMPERATURE=\"#{message.current_temperature}\""
puts "TEMPERATURE_RANGE=\"#{message.temperature_range}\""
puts "SET_TEMPERATURE=\"#{message.set_temperature}\""
puts "HEATING=\"#{message.heating}\""
puts "DETAILS=\"#{message.inspect}\""


