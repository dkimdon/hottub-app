#!/usr/bin/env ruby

require 'bwa/client'
require 'bwa/discovery'

if ARGV.empty?
  spas = BWA::Discovery.discover
  if spas.empty?
    $stderr.puts "Could not find spa!"
    exit 1
  end
  spa_ip = spas.first.first
else
  spa_ip = ARGV[0]
end

spa = BWA::Client.new(spa_ip)

spa.last_status
message = spa.poll
puts "{ \"heating_mode\":\"#{message.heating_mode}\", \"temperature\":#{message.current_temperature}, \"temperature_range\":\"#{message.temperature_range}\", \"set_temperature\":#{message.set_temperature}, \"heating\":#{message.heating} }"


